#!/usr/bin/bash

set -o errexit
set -o pipefail

LOG="$HOME/tty2.log"
echo "Logging to $LOG"

# Required by jh-fo...
export TZ=UTC

exec &> >(tee "$LOG")

if [ "$(id -u)" == "0" ]; then
    echo "Switching to user jehon-tty"
    # User need access to /dev/fb0
    su jehon-tty "$0"
fi

# /usr/bin/fbi --autozoom --timeout 15 "/var/cache/jehon/pictures"/*

echo ""
echo "*** Selecting pictures..."
PICTURES_RAW="$(/usr/bin/jh-fo select --amount=30 /mnt/cloud/photos/)"
readarray -t PICTURES_LIST <<<"${PICTURES_RAW}"

echo ""
echo "*** Launching display..."
/usr/bin/fbi --autozoom --timeout 15 "${PICTURES_LIST[@]}"

echo ""
echo "*** TTY Photos Script has exited..."
sleep 30s
exit 1
