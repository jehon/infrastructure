#!/usr/bin/env bash

#
# No jh-lib since it can be called
# as standalone...
#

set -o errexit

if [ "$(whoami)" != "root" ]; then
    echo "You need to be root"
    exit 1
fi

export DEBIAN_FRONTEND=noninteractive

BEFORE="$( node --version || true)"
VERSION="${1:-current}"
curl -fsSL "https://deb.nodesource.com/setup_$VERSION.x" | bash - >/dev/null

if ! type nodejs >& /dev/null ; then
    echo "[modified] Installing nodejs"
    apt update
    apt install --yes --quiet nodejs
else
    echo "** Skipping installation of nodejs since it is already present"
fi
AFTER="$( node --version || true)"

if [ "$BEFORE" != "$AFTER" ]; then
    echo "[modified] Version has changed: ${BEFORE} => ${AFTER}"
else
    echo "Vesrion was installed: ${BEFORE}"
fi
