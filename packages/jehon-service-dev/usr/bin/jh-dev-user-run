#!/usr/bin/env bash

# !! Must run as end-user

set -o errexit
set -o pipefail
shopt -s nullglob

_SD="$(dirname "$(realpath "${BASH_SOURCE[0]}")")"

# shellcheck source-path=SCRIPTDIR/../../../jehon/usr/bin/
. jh-lib

context="$1"
configRoot="${HOME}/src/infrastructure/conf/auto"
config="${configRoot}/${context}"

[ -d "${configRoot}" ] || jh_fatal "Config folder not found: ${configRoot}"
[ -d "${config}" ] || jh_fatal "Context config not found: ${config}"

case "${context}" in
"daily" | "hourly")
    jh-runner "${config}"
    ;;
"location")
    location="${LOCATION}"
    if [ -z "${location}" ]; then
        location="$(jh-location-detect)"
    fi
    jh-runner "${config}/${location}"
    jh-runner "${config}/always"
    ;;
*)
    jh_fatal "Context not found: ${context}"
    ;;
esac
