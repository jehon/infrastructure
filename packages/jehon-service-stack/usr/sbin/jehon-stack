#!/usr/bin/env bash

set -o errexit
set -o pipefail

# shellcheck source-path=SCRIPTDIR/../bin/
. jh-stack-lib

if [ ! -r "${stackRoot}" ]; then
    jh_fatal "No stack found"
fi

cd "${stackRoot}"

if [ ! -r .git ]; then
    jh_fatal "No git repository found"
fi

git fetch
git reset --hard origin

cat >"${stackRoot}"/.env <<EOS
# User running the stack
# id: $(id)
PUID=$(id -u)
PGID=$(id -g)
TZ=$(cat /etc/timezone)
EOS

if [ -d "${stackRoot}"/cron ]; then
    header_begin "Running the cron"
    jh-runner "${stackRoot}"/cron
    header_end
fi
