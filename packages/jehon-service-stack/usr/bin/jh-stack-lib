#!/usr/bin/env bash

set -o errexit

# shellcheck source-path=SCRIPTDIR/../../../jehon/usr/bin
. jh-lib

#
#
# Helpers
#
#

stackRoot=/home/jehon-daemon/stack
export stackRoot

currentService=
# currentServiceUid=
on() {
    currentService="$1"
    # currentServiceUid="1000" # Most container run as 1000

    header "* ${currentService}"
}

# with_user() {
#     # By default, user is 1000
#     currentServiceUid="${1:1000}"
# }

with_folder() {
    context="${1:?Need the context: data/cache}"
    name="$2" # May be empty

    # Give access to the operators and remove access from others
    folder="${stackRoot}/volumes/${currentService}/${context}/${currentService}/${name}"
    install -v --directory "${folder}"
    # chown --change --recursive "${currentServiceUid}:operators" "${folder}"
    # chmod --change --recursive g+rwX,o-rwx "${folder}"
}

# with_etc() {
#     with_folder "etc" "$1"
# }
with_etc() {
    with_folder "etc" "$1"
}

with_var() {
    with_folder "var" "$1"
}

# with_cache() {
#     with_folder "cache" "$1"
# }
