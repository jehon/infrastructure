#!/usr/bin/env bash

set -o errexit
set -o pipefail
shopt -s nullglob

_SD="$(dirname "$(realpath "${BASH_SOURCE[0]}")")"

# shellcheck source-path=SCRIPTDIR
. "${_SD}"/lib.sh

moveWindowTo() {
    # Thanks to https://askubuntu.com/a/702302/638656

    window="${1:?Need window to move}"
    position="${2:?Need target position}" # x,y,w,h (gravity is hardcoded)
    desktop="${3:?Need the desktop}"
    shift
    shift
    # Options for [...]:
    #    - maximized_vert
    #    - maximized_horz

    winId=$(
        wmctrl -l |
            grep -E -- "${window}" |
            cut -d" " -f1 || true
    )

    if [ -z "${winId}" ]; then
        echo "Window not found: ${window}"
        return
    fi
    echo "Window: ${winId}: move to ${position}"

    wmctrl -ir "$winId" -b remove,maximized_vert
    wmctrl -ir "$winId" -b remove,maximized_horz
    wmctrl -ir "$winId" -e 0,"$position"
    wmctrl -ir "$winId" -s "$desktop"
    while [ -n "$1" ]; do
        wmctrl -ir "$winId" -b add,"$1"
        shift
    done
}

# S_LEFT_L=0
S_FRONT_L=1920
S_FRONT_W=3440

case "$1" in
"")
    moveWindowTo 'Spotify' "0,0,100,100" 1 maximized_vert maximized_horz
    moveWindowTo '.* - infrastructure$' "$((S_FRONT_L)),0,$((S_FRONT_W / 2)),100" 1 maximized_vert
    #    moveWindowTo '- cryptomedic$' 'DP-3'
    ;;
"ls-windows")
    wmctrl -l
    exit 0
    ;;
"ls-screens")
    xrandr | grep " connected"
    exit 0
    ;;
*)
    jh_fatal "Unknown verb: $1"
    ;;
esac
