---

# https://docs.ansible.com/ansible/latest/collections/ansible/builtin/package_facts_module.html
- name: Get installed packages
  when: ansible_pkg_mgr == "apt"
  ansible.builtin.package_facts:
    manager: auto

# - name: Guess os
#   when: jehon_os | length == 0 and ansible_pkg_mgr == "apt"
#   block:
#     - name: Ensure lsb_module is installed
#       ansible.builtin.apt:
#         pkg:
#           - lsb-release

#     - name: Recalculate ansible_lsb
#       # ansible_lsb (or jehon_deb) depend on lsb-release to be installed => always refresh this value
#       ansible.builtin.setup:
#         filter:
#           # What to recalculate ?
#           - ansible_lsb

#     - name: Calculate os name from ansible_lsb.id
#       when: ansible_lsb.id | length > 0
#       ansible.builtin.set_fact:
#         jehon_os: "{{ ansible_lsb.id | lower }}"

#     - name: Fallback jehon_os
#       ansible.builtin.set_fact:
#         jehon_os: ""

- name: What is jehon_os?
  ansible.builtin.debug:
    var: jehon_os
